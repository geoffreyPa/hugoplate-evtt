{{ define "main" }}
  {{ partial "page-header" . }}

  <section class="section-sm">
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-12">
          <div class="content">
            {{ .Content }}
            
            <!-- Filtres par groupes -->
            <div id="filters-container" class="mt-6 mb-4 hidden">
              <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-lg font-semibold mb-3">üéØ Filtrer par groupes</h3>
                <div id="group-filters" class="flex flex-wrap gap-2">
                  <button id="filter-all" class="filter-btn active px-4 py-2 rounded-full text-sm font-medium bg-blue-600 text-white border-2 border-blue-600 hover:bg-blue-700 transition-colors">
                    Tous les groupes
                  </button>
                  <!-- Les filtres par groupe seront ajout√©s dynamiquement ici -->
                </div>
                <div class="mt-3 text-sm text-gray-600">
                  <span id="events-count">Chargement...</span>
                </div>
              </div>
            </div>

            <!-- Planning Calendar Container -->
            <div id="calendar-container" class="mt-8">
              <div id="planning-calendar" class="bg-white rounded-lg shadow-lg p-6"></div>
            </div>
            
            <!-- Loading indicator -->
            <div id="loading-indicator" class="text-center py-8">
              <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
              <p class="mt-2 text-gray-600">Chargement du planning...</p>
            </div>
            
            <!-- Error message -->
            <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mt-4">
              <span id="error-text"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Include FullCalendar CSS and JS (version bundle) -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css" rel="stylesheet" />
  
  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
  
  <!-- FullCalendar Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  
  <!-- Custom planning script -->
  {{ $planningJS := resources.Get "js/planning.js" | minify }}
  <script src="{{ $planningJS.RelPermalink }}"></script>
  
  <!-- Initialize planning after all scripts loaded -->
  <script>
    window.addEventListener('load', function() {
      // V√©rifier que FullCalendar et Supabase sont disponibles
      if (typeof FullCalendar === 'undefined') {
        console.error('FullCalendar non disponible');
        document.getElementById('loading-indicator').style.display = 'none';
        document.getElementById('error-message').classList.remove('hidden');
        document.getElementById('error-text').textContent = 'Erreur de chargement: FullCalendar non disponible';
        return;
      }
      
      if (typeof window.supabase === 'undefined') {
        console.error('Supabase non disponible');
        document.getElementById('loading-indicator').style.display = 'none';
        document.getElementById('error-message').classList.remove('hidden');
        document.getElementById('error-text').textContent = 'Erreur de chargement: Supabase non disponible';
        return;
      }
      
      // Cr√©er l'instance du planning
      try {
        window.planningVTT = new PlanningVTT();
        console.log('Planning VTT initialis√© avec succ√®s');
      } catch (error) {
        console.error('Erreur lors de l\'initialisation du planning:', error);
        document.getElementById('loading-indicator').style.display = 'none';
        document.getElementById('error-message').classList.remove('hidden');
        document.getElementById('error-text').textContent = 'Erreur d\'initialisation: ' + error.message;
      }
    });
  </script>
  
  <!-- Styles personnalis√©s pour le calendrier -->
  <style>
    #calendar-container {
      display: none;
    }
    
    .fc-theme-standard .fc-scrollgrid {
      border: none;
    }
    
    .fc-event {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .fc-event:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .calendar-tooltip {
      position: fixed;
      z-index: 1000;
      pointer-events: none;
    }
    
    .fc-daygrid-event {
      margin: 1px 0;
    }
    
    .fc-event-title {
      font-weight: 600;
    }
    
    .fc-header-toolbar {
      margin-bottom: 1.5em;
    }
    
    .fc-button-primary {
      background-color: var(--primary-color, #3b82f6);
      border-color: var(--primary-color, #3b82f6);
    }
    
    .fc-button-primary:hover {
      background-color: var(--primary-dark, #2563eb);
      border-color: var(--primary-dark, #2563eb);
    }
    
    .fc-toolbar-title {
      font-size: 1.5rem !important;
      font-weight: 600;
    }
    
    /* Styles pour les filtres */
    .filter-btn {
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      position: relative;
      backdrop-filter: blur(10px);
      border-width: 2px;
      border-style: solid;
      font-weight: 500;
    }
    
    .filter-btn:not(.active) {
      background-color: rgba(255, 255, 255, 0.9);
      color: #4b5563;
      border-color: #d1d5db;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .filter-btn:not(.active):hover {
      background-color: rgba(249, 250, 251, 0.95);
      border-color: #9ca3af;
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .filter-btn.active {
      border-width: 3px !important;
      font-weight: 700 !important;
      transform: scale(1.08) translateY(-3px) !important;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2), 0 0 0 4px rgba(0, 0, 0, 0.1) !important;
      position: relative;
      z-index: 10;
    }
    
    .filter-btn.active::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.1));
      z-index: -1;
      animation: activeGlow 2s infinite alternate;
    }
    
    @keyframes activeGlow {
      0% { opacity: 0.5; }
      100% { opacity: 0.8; }
    }
    
    .filter-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .filter-btn:hover::before {
      opacity: 1;
    }
    
    /* Animation pour les compteurs */
    .filter-btn .count-badge {
      transition: all 0.3s ease;
      font-weight: 600;
    }
    
    .filter-btn.active .count-badge {
      background-color: rgba(255, 255, 255, 0.25) !important;
      color: inherit !important;
      transform: scale(1.1);
    }
    
    .filter-btn:not(.active) .count-badge {
      background-color: #f3f4f6;
      color: #6b7280;
    }
    
    /* Vue liste personnalis√©e */
    .fc-list-event-graphic {
      width: 8px !important;
    }
    
    .fc-list-event-title {
      font-weight: 600;
    }
    
    .fc-list-event-time {
      color: #6b7280;
      font-weight: 500;
    }
    
    .fc-list-day-cushion {
      background-color: #f8fafc !important;
      font-weight: 600;
      color: #1f2937;
    }
    
    .fc-list-event:hover {
      background-color: #f8fafc;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .fc-header-toolbar {
        flex-direction: column;
        gap: 1rem;
      }
      
      .fc-toolbar-chunk {
        display: flex;
        justify-content: center;
      }
      
      .fc-button-group {
        border-radius: 0.5rem;
      }
      
      #group-filters {
        justify-content: center;
      }
      
      .filter-btn {
        font-size: 0.875rem;
        padding: 0.5rem 0.75rem;
      }
    }
  </style>
{{ end }}
