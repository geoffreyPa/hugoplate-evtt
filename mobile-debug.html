<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Mobile - Naturavelo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üîç Debug Mobile - Naturavelo</h1>
    
    <div class="debug-info">
        <h2>Informations de l'appareil</h2>
        <div id="device-info"></div>
    </div>
    
    <div class="debug-info">
        <h2>Test de connectivit√©</h2>
        <div id="connectivity-info"></div>
    </div>
    
    <div class="debug-info">
        <h2>Test Supabase</h2>
        <button onclick="testSupabase()">Tester la connexion Supabase</button>
        <div id="supabase-result"></div>
    </div>
    
    <div class="debug-info">
        <h2>Test Webhook</h2>
        <button onclick="testWebhook()">Tester le webhook</button>
        <div id="webhook-result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configuration Supabase
        const supabaseUrl = 'https://jiforbxelcpihbphrtzx.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImppZm9yYnhlbGNwaWhicGhydHp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MzczMjEsImV4cCI6MjA2OTIxMzMyMX0.L1RMxREEi9txY-n31Bbrl4A9nWm2E_47WzaYdbrwVt8';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // D√©tecter l'appareil
        function detectDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isTablet = /iPad|Android/i.test(navigator.userAgent) && !/Mobile/i.test(navigator.userAgent);
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            
            const deviceInfo = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                isMobile: isMobile,
                isTablet: isTablet,
                screenWidth: screen.width,
                screenHeight: screen.height,
                windowWidth: window.innerWidth,
                windowHeight: window.innerHeight,
                connection: connection ? {
                    effectiveType: connection.effectiveType,
                    downlink: connection.downlink,
                    rtt: connection.rtt,
                    saveData: connection.saveData
                } : 'Non disponible'
            };
            
            return deviceInfo;
        }
        
        // Afficher les informations de l'appareil
        function displayDeviceInfo() {
            const device = detectDevice();
            const deviceInfoDiv = document.getElementById('device-info');
            
            let html = '<div class="info status">';
            html += `<strong>Type d'appareil:</strong> ${device.isMobile ? 'Mobile' : device.isTablet ? 'Tablette' : 'Desktop'}<br>`;
            html += `<strong>Plateforme:</strong> ${device.platform}<br>`;
            html += `<strong>R√©solution √©cran:</strong> ${device.screenWidth}x${device.screenHeight}<br>`;
            html += `<strong>Fen√™tre:</strong> ${device.windowWidth}x${device.windowHeight}<br>`;
            html += `<strong>User Agent:</strong> ${device.userAgent}<br>`;
            html += '</div>';
            
            if (device.connection !== 'Non disponible') {
                html += '<div class="info status">';
                html += `<strong>Type de connexion:</strong> ${device.connection.effectiveType || 'Inconnu'}<br>`;
                html += `<strong>Vitesse:</strong> ${device.connection.downlink || 'Inconnue'} Mbps<br>`;
                html += `<strong>Latence:</strong> ${device.connection.rtt || 'Inconnue'} ms<br>`;
                html += `<strong>Mode √©conomie:</strong> ${device.connection.saveData ? 'Oui' : 'Non'}<br>`;
                html += '</div>';
            }
            
            deviceInfoDiv.innerHTML = html;
        }
        
        // Tester la connectivit√©
        function testConnectivity() {
            const connectivityDiv = document.getElementById('connectivity-info');
            const device = detectDevice();
            
            let html = '';
            
            // Test de base
            if (navigator.onLine) {
                html += '<div class="success status">‚úÖ Connexion internet active</div>';
            } else {
                html += '<div class="error status">‚ùå Pas de connexion internet</div>';
            }
            
            // Test de vitesse
            if (device.connection && device.connection.effectiveType) {
                const connectionType = device.connection.effectiveType;
                if (connectionType === 'slow-2g' || connectionType === '2g') {
                    html += '<div class="warning status">‚ö†Ô∏è Connexion tr√®s lente d√©tect√©e (2G/GPRS)</div>';
                } else if (connectionType === '3g') {
                    html += '<div class="warning status">‚ö†Ô∏è Connexion lente d√©tect√©e (3G)</div>';
                } else if (connectionType === '4g') {
                    html += '<div class="success status">‚úÖ Connexion rapide d√©tect√©e (4G)</div>';
                }
            }
            
            // Test de latence
            if (device.connection && device.connection.rtt) {
                const rtt = device.connection.rtt;
                if (rtt > 1000) {
                    html += '<div class="warning status">‚ö†Ô∏è Latence √©lev√©e: ' + rtt + 'ms</div>';
                } else if (rtt > 500) {
                    html += '<div class="info status">‚ÑπÔ∏è Latence mod√©r√©e: ' + rtt + 'ms</div>';
                } else {
                    html += '<div class="success status">‚úÖ Latence faible: ' + rtt + 'ms</div>';
                }
            }
            
            connectivityDiv.innerHTML = html;
        }
        
        // Tester Supabase
        async function testSupabase() {
            const resultDiv = document.getElementById('supabase-result');
            resultDiv.innerHTML = '<div class="info status">üîÑ Test en cours...</div>';
            
            try {
                const startTime = Date.now();
                const { data, error } = await supabase
                    .from('inscriptions_weekend_vtt')
                    .select('count', { count: 'exact', head: true })
                    .limit(1);
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                if (error) {
                    resultDiv.innerHTML = '<div class="error status">‚ùå Erreur Supabase: ' + error.message + '</div>';
                } else {
                    resultDiv.innerHTML = '<div class="success status">‚úÖ Connexion Supabase r√©ussie (' + duration + 'ms)</div>';
                }
            } catch (err) {
                resultDiv.innerHTML = '<div class="error status">‚ùå Erreur de connexion: ' + err.message + '</div>';
            }
        }
        
        // Tester le webhook
        async function testWebhook() {
            const resultDiv = document.getElementById('webhook-result');
            resultDiv.innerHTML = '<div class="info status">üîÑ Test en cours...</div>';
            
            try {
                const startTime = Date.now();
                const response = await fetch('https://automate.naturavelo.net/webhook/inscri-week-evtt?test=1', {
                    method: 'GET',
                    cache: 'no-cache',
                    mode: 'cors'
                });
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success status">‚úÖ Webhook accessible (' + duration + 'ms)</div>';
                } else {
                    resultDiv.innerHTML = '<div class="warning status">‚ö†Ô∏è Webhook r√©pond avec le code: ' + response.status + ' (' + duration + 'ms)</div>';
                }
            } catch (err) {
                resultDiv.innerHTML = '<div class="error status">‚ùå Erreur webhook: ' + err.message + '</div>';
            }
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            displayDeviceInfo();
            testConnectivity();
        });
    </script>
</body>
</html>
